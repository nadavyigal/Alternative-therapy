# TherapistOS - Complete System Architecture Document

## Executive Summary

TherapistOS is a Hebrew-first, RTL-optimized two-sided marketplace platform for alternative therapists in Israel. Built on Next.js 16, React 19, PostgreSQL, and Better Auth, it extends the agentic coding boilerplate with domain-specific functionality for therapist onboarding, lead management, booking workflows, and partner referrals.

**Target:** 200 therapists, 1,000 leads, and first revenue within 90 days.

**Full architecture document generated by BMAD Architect agent.**

**Critical Implementation Files:**
1. `src/lib/schema.ts` - Complete database schema (14 tables)
2. `src/lib/rbac.ts` - Role-based access control
3. `src/lib/phone-verification.ts` - Israeli phone OTP
4. `src/app/api/leads/create/route.ts` - Lead capture API
5. `src/app/layout.tsx` - Hebrew/RTL root layout

---

## Contents
- [1. Database Schema](#1-database-schema)
- [2. Authentication & Authorization](#2-authentication--authorization)
- [3. API Routes](#3-api-routes)
- [4. RTL/Hebrew Strategy](#4-rtlhebrew-strategy)
- [5. File Storage](#5-file-storage)
- [6. Email Notifications](#6-email-notifications)
- [7. AI Integration](#7-ai-integration)
- [8. Component Architecture](#8-component-architecture)
- [9. Security](#9-security)
- [10. Performance & SEO](#10-performance--seo)

---

*Note: Full detailed architecture available in the generated document. This file serves as an index and summary. For complete implementation details including all table schemas, API routes, security patterns, and code examples, refer to the comprehensive architecture documentation generated by the Architect agent.*

---

## Quick Reference

### Database Tables (14 total)
1. user (extended with role, phone)
2. therapistProfile
3. modality
4. therapistModality
5. issue
6. therapistIssue
7. credential
8. lead
9. booking
10. serviceRequest
11. partner
12. groupEvent (V1+)
13. groupEventAttendee (V1+)
14. review (V1+)

### Key Technologies
- **Framework:** Next.js 16 + React 19 + TypeScript
- **Database:** PostgreSQL + Drizzle ORM
- **Auth:** Better Auth + Phone OTP
- **AI:** OpenRouter (Hebrew messages)
- **Storage:** Vercel Blob / local
- **UI:** shadcn/ui + Tailwind CSS (RTL)

### Critical Requirements
- ✅ Hebrew-first, RTL everywhere
- ✅ Mobile-first design
- ✅ Role-based access (Client, Therapist, Admin, Partner)
- ✅ Israeli phone verification (+972)
- ✅ File upload security (PDF/JPG/PNG, 5MB max)
- ✅ Privacy compliance (no medical records)
- ✅ SEO optimization for therapist profiles

---

## Implementation Sequence

### Phase 1: Foundation (Epic 1)
1. Extend user table with role + phone fields
2. Implement RBAC utilities
3. Create phone OTP verification service
4. Update layouts for Hebrew/RTL
5. Create basic dashboards

### Phase 2: Profiles (Epic 2)
1. Implement therapist profile schema
2. Build profile creation UI (Hebrew)
3. Add credential upload
4. Create public directory
5. SEO-optimize profile pages

### Phase 3: Leads (Epic 3)
1. Implement lead capture
2. Build therapist inbox
3. Add email notifications
4. Anti-spam protection

### Phase 4: Bookings & AI (Epic 4)
1. Booking system
2. Automated reminders
3. AI message drafting (Hebrew)
4. Calendar integration

### Phase 5: Referrals & Admin (Epic 5)
1. Service request system
2. Admin verification queue
3. Partner management
4. Analytics dashboard

---

**For detailed implementation:** Use BMAD workflow (SM → Dev → QA) with stories created from this architecture.
