story:
  id: "3.1"
  epic: "Epic 3 - Leads & CRM"
  title: "Create lead schema and data access"
  priority: "P0"
  estimatedHours: 6

userStory: |
  As a therapist
  I want lead records stored with a status pipeline
  So that I can track client inquiries from first contact to outcome

tasks:
  - id: "3.1.1"
    description: "Add lead_status enum and lead table in src/lib/schema.ts"
    files: ["src/lib/schema.ts"]
  - id: "3.1.2"
    description: "Create lead data access helpers (create/list/update status)"
    files: ["src/lib/leads.ts"]
  - id: "3.1.3"
    description: "Create migration for lead schema"
    files: ["drizzle/000X_*", "drizzle/meta/_journal.json", "drizzle/meta/000X_snapshot.json"]

acceptanceCriteria:
  - "lead_status enum includes new, contacted, booked, closed, no_show"
  - "Lead table includes therapistProfileId, clientName, clientPhone, message, status, source, createdAt, updatedAt"
  - "Each lead references therapist_profile with cascade delete"
  - "Status defaults to new and source defaults to profile"
  - "Data helpers support create, list by therapist profile, and status updates"
  - "Migration files added and tracked"

technicalSpecs:
  database:
    - "Use uuid primary key with default gen_random_uuid()"
    - "Index therapist_profile_id and status for inbox filtering"
  dependencies:
    - "therapist_profile table exists"
  implementationNotes:
    - "Store clientPhone in normalized +972 format"
    - "Avoid storing sensitive medical details in lead messages"

tests:
  - "Type check passes"
  - "Migration runs successfully (local environment)"

definitionOfDone:
  - "[ ] Schema updated"
  - "[ ] Migration added"
  - "[ ] Data helpers implemented"
  - "[ ] Story marked complete"

status:
  created: true
  implemented: true
  qa: "pass"
  notes:
    - "Tests not run in this environment."
    - "QA review complete; no blocking issues found."
