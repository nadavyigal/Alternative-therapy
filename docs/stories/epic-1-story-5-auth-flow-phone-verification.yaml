story:
  id: "1.5"
  epic: "Epic 1 - Foundation & Auth"
  title: "Update auth flow for phone verification"
  priority: "P0"
  estimatedHours: 5

userStory: |
  As a therapist
  I want the signup and onboarding flow to include phone verification
  So that I can publish my profile only after verifying my number

tasks:
  - id: "1.5.1"
    description: "Add phone verification step to onboarding flow"
    files: ["src/app/(auth)/onboarding/page.tsx", "src/components/auth/*"]
  - id: "1.5.2"
    description: "Persist phone and phoneVerified on user"
    files: ["src/lib/schema.ts", "src/lib/auth.ts"]
  - id: "1.5.3"
    description: "Enforce phone verification before profile publish"
    files: ["src/app/(therapist)/*", "src/components/therapist/*"]
  - id: "1.5.4"
    description: "Document updated auth flow"
    files: ["docs/architecture/02-authentication-authorization.md"]

acceptanceCriteria:
  - "Therapist onboarding includes phone verification step"
  - "Phone verification required before profile publish"
  - "Phone and phoneVerified saved on user record"
  - "All UI strings for verification are Hebrew"

technicalSpecs:
  implementation:
    - "Use phone verification utilities from src/lib/phone-verification.ts"
    - "Gate profile publish action on phoneVerified"
  dependencies:
    - "Phone verification utilities (Story 1.3)"
    - "RBAC utilities (Story 1.2)"

tests:
  - "Integration test: onboarding requires phone verification"
  - "Type check passes"

definitionOfDone:
  - "[ ] Onboarding includes phone verification"
  - "[ ] Profile publish gated by phoneVerified"
  - "[ ] Documentation updated"
  - "[ ] TypeScript compiles without errors"
  - "[ ] Story marked complete"

status:
  created: true
  implemented: true
  qa: "pass"
  notes:
    - "profile publish gating to be enforced when publish feature exists"
