story:
  id: "2.3"
  epic: "Epic 2 - Profiles & Directory"
  title: "Credential upload storage and schema"
  priority: "P0"
  estimatedHours: 6

userStory: |
  As a therapist
  I want to upload credentials for verification
  So that my profile can be trusted by clients

tasks:
  - id: "2.3.1"
    description: "Add credential table and enum to src/lib/schema.ts"
    files: ["src/lib/schema.ts"]
  - id: "2.3.2"
    description: "Add credential data helpers"
    files: ["src/lib/credentials.ts"]
  - id: "2.3.3"
    description: "Create upload API route for credential files"
    files: ["src/app/api/uploads/credential/route.ts"]
  - id: "2.3.4"
    description: "Create migration for credential schema"
    files:
      [
        "drizzle/0005_*",
        "drizzle/meta/_journal.json",
        "drizzle/meta/0005_snapshot.json",
      ]

acceptanceCriteria:
  - "Credential table includes status, file URL, and verification fields"
  - "Upload API enforces PDF/JPG/PNG and 5MB limit"
  - "Credential entries are tied to therapist_profile"
  - "Migration files added and tracked"

technicalSpecs:
  database:
    - "credential uses uuid primary key with default gen_random_uuid()"
    - "credential_status enum includes pending, approved, rejected"
  dependencies:
    - "therapist_profile table exists"
    - "storage upload helper exists"
  implementationNotes:
    - "Use RBAC in upload API"
    - "No UI changes in this story"

tests:
  - "Type check passes"
  - "Migration runs successfully (local environment)"

definitionOfDone:
  - "[ ] Schema updated"
  - "[ ] Migration added"
  - "[ ] Upload API added"
  - "[ ] Story marked complete"

status:
  created: true
  implemented: true
  qa: "passed"
  notes:
    - "Tests not run in this environment."
